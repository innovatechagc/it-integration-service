<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webhook Simulator - Integration Testing</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .platform-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .platform-section h3 { color: #333; margin-top: 0; }
        textarea { width: 100%; height: 150px; font-family: monospace; }
        button { background: #007cba; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #005a87; }
        .response { margin-top: 10px; padding: 10px; background: #f0f0f0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 200px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîó Webhook Simulator - Integration Testing</h1>
        <p>Simulador para probar webhooks de diferentes plataformas de mensajer√≠a</p>
        
        <!-- WhatsApp Meta -->
        <div class="platform-section">
            <h3>üì± WhatsApp (Meta)</h3>
            <div class="form-group">
                <label>Webhook URL:</label>
                <input type="text" id="whatsapp-url" value="http://localhost:8080/webhooks/whatsapp/meta" />
            </div>
            <div class="form-group">
                <label>Tipo de mensaje:</label>
                <select id="whatsapp-type">
                    <option value="text">Texto</option>
                    <option value="image">Imagen</option>
                    <option value="document">Documento</option>
                    <option value="status">Estado de entrega</option>
                </select>
            </div>
            <textarea id="whatsapp-payload">{
  "object": "whatsapp_business_account",
  "entry": [{
    "id": "WHATSAPP_BUSINESS_ACCOUNT_ID",
    "changes": [{
      "value": {
        "messaging_product": "whatsapp",
        "metadata": {
          "display_phone_number": "15550559999",
          "phone_number_id": "PHONE_NUMBER_ID"
        },
        "messages": [{
          "from": "16505551234",
          "id": "wamid.ID",
          "timestamp": "1669233778",
          "text": {
            "body": "Hello! This is a test message from WhatsApp"
          },
          "type": "text"
        }]
      },
      "field": "messages"
    }]
  }]
}</textarea>
            <button onclick="sendWebhook('whatsapp')">Enviar Webhook WhatsApp</button>
            <div id="whatsapp-response" class="response" style="display:none;"></div>
        </div>

        <!-- Telegram -->
        <div class="platform-section">
            <h3>‚úàÔ∏è Telegram</h3>
            <div class="form-group">
                <label>Webhook URL:</label>
                <input type="text" id="telegram-url" value="http://localhost:8080/webhooks/telegram" />
            </div>
            <textarea id="telegram-payload">{
  "update_id": 123456789,
  "message": {
    "message_id": 1234,
    "from": {
      "id": 987654321,
      "is_bot": false,
      "first_name": "Test",
      "last_name": "User",
      "username": "testuser"
    },
    "chat": {
      "id": 987654321,
      "first_name": "Test",
      "last_name": "User",
      "username": "testuser",
      "type": "private"
    },
    "date": 1669233778,
    "text": "Hello! This is a test message from Telegram"
  }
}</textarea>
            <button onclick="sendWebhook('telegram')">Enviar Webhook Telegram</button>
            <div id="telegram-response" class="response" style="display:none;"></div>
        </div>

        <!-- Messenger -->
        <div class="platform-section">
            <h3>üí¨ Messenger (Meta)</h3>
            <div class="form-group">
                <label>Webhook URL:</label>
                <input type="text" id="messenger-url" value="http://localhost:8080/webhooks/messenger" />
            </div>
            <textarea id="messenger-payload">{
  "object": "page",
  "entry": [{
    "id": "PAGE_ID",
    "time": 1669233778000,
    "messaging": [{
      "sender": {
        "id": "USER_ID"
      },
      "recipient": {
        "id": "PAGE_ID"
      },
      "timestamp": 1669233778000,
      "message": {
        "mid": "MESSAGE_ID",
        "text": "Hello! This is a test message from Messenger"
      }
    }]
  }]
}</textarea>
            <button onclick="sendWebhook('messenger')">Enviar Webhook Messenger</button>
            <div id="messenger-response" class="response" style="display:none;"></div>
        </div>

        <!-- Instagram -->
        <div class="platform-section">
            <h3>üì∑ Instagram</h3>
            <div class="form-group">
                <label>Webhook URL:</label>
                <input type="text" id="instagram-url" value="http://localhost:8080/webhooks/instagram" />
            </div>
            <textarea id="instagram-payload">{
  "object": "instagram",
  "entry": [{
    "id": "INSTAGRAM_ACCOUNT_ID",
    "time": 1669233778,
    "messaging": [{
      "sender": {
        "id": "USER_ID"
      },
      "recipient": {
        "id": "INSTAGRAM_ACCOUNT_ID"
      },
      "timestamp": 1669233778000,
      "message": {
        "mid": "MESSAGE_ID",
        "text": "Hello! This is a test message from Instagram"
      }
    }]
  }]
}</textarea>
            <button onclick="sendWebhook('instagram')">Enviar Webhook Instagram</button>
            <div id="instagram-response" class="response" style="display:none;"></div>
        </div>

        <!-- Herramientas adicionales -->
        <div class="platform-section">
            <h3>üõ†Ô∏è Herramientas</h3>
            <button onclick="testHealthCheck()">Test Health Check</button>
            <button onclick="listIntegrations()">Listar Integraciones</button>
            <button onclick="clearResponses()">Limpiar Respuestas</button>
            <div id="tools-response" class="response" style="display:none;"></div>
        </div>
    </div>

    <script>
        async function sendWebhook(platform) {
            const url = document.getElementById(platform + '-url').value;
            const payload = document.getElementById(platform + '-payload').value;
            const responseDiv = document.getElementById(platform + '-response');
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: payload
                });
                
                const result = await response.text();
                responseDiv.innerHTML = `
                    <strong>Status:</strong> ${response.status}<br>
                    <strong>Response:</strong><br>
                    <pre>${result}</pre>
                `;
                responseDiv.className = response.ok ? 'response success' : 'response error';
                responseDiv.style.display = 'block';
            } catch (error) {
                responseDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
                responseDiv.className = 'response error';
                responseDiv.style.display = 'block';
            }
        }

        async function testHealthCheck() {
            const responseDiv = document.getElementById('tools-response');
            try {
                const response = await fetch('http://localhost:8080/api/v1/health');
                const result = await response.json();
                responseDiv.innerHTML = `
                    <strong>Health Check:</strong><br>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
                responseDiv.className = 'response success';
                responseDiv.style.display = 'block';
            } catch (error) {
                responseDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
                responseDiv.className = 'response error';
                responseDiv.style.display = 'block';
            }
        }

        async function listIntegrations() {
            const responseDiv = document.getElementById('tools-response');
            try {
                const response = await fetch('http://localhost:8080/api/v1/integrations');
                const result = await response.json();
                responseDiv.innerHTML = `
                    <strong>Integraciones:</strong><br>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
                responseDiv.className = 'response success';
                responseDiv.style.display = 'block';
            } catch (error) {
                responseDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
                responseDiv.className = 'response error';
                responseDiv.style.display = 'block';
            }
        }

        function clearResponses() {
            const responses = document.querySelectorAll('.response');
            responses.forEach(div => div.style.display = 'none');
        }

        // Cargar payloads de ejemplo seg√∫n el tipo seleccionado
        document.getElementById('whatsapp-type').addEventListener('change', function() {
            const type = this.value;
            const textarea = document.getElementById('whatsapp-payload');
            
            const payloads = {
                text: `{
  "object": "whatsapp_business_account",
  "entry": [{
    "id": "WHATSAPP_BUSINESS_ACCOUNT_ID",
    "changes": [{
      "value": {
        "messaging_product": "whatsapp",
        "metadata": {
          "display_phone_number": "15550559999",
          "phone_number_id": "PHONE_NUMBER_ID"
        },
        "messages": [{
          "from": "16505551234",
          "id": "wamid.ID",
          "timestamp": "1669233778",
          "text": {
            "body": "Hello! This is a test message from WhatsApp"
          },
          "type": "text"
        }]
      },
      "field": "messages"
    }]
  }]
}`,
                image: `{
  "object": "whatsapp_business_account",
  "entry": [{
    "id": "WHATSAPP_BUSINESS_ACCOUNT_ID",
    "changes": [{
      "value": {
        "messaging_product": "whatsapp",
        "metadata": {
          "display_phone_number": "15550559999",
          "phone_number_id": "PHONE_NUMBER_ID"
        },
        "messages": [{
          "from": "16505551234",
          "id": "wamid.ID",
          "timestamp": "1669233778",
          "type": "image",
          "image": {
            "id": "IMAGE_ID",
            "mime_type": "image/jpeg",
            "caption": "Test image"
          }
        }]
      },
      "field": "messages"
    }]
  }]
}`,
                status: `{
  "object": "whatsapp_business_account",
  "entry": [{
    "id": "WHATSAPP_BUSINESS_ACCOUNT_ID",
    "changes": [{
      "value": {
        "messaging_product": "whatsapp",
        "metadata": {
          "display_phone_number": "15550559999",
          "phone_number_id": "PHONE_NUMBER_ID"
        },
        "statuses": [{
          "id": "wamid.ID",
          "status": "delivered",
          "timestamp": "1669233778",
          "recipient_id": "16505551234"
        }]
      },
      "field": "messages"
    }]
  }]
}`
            };
            
            textarea.value = payloads[type] || payloads.text;
        });
    </script>
</body>
</html>